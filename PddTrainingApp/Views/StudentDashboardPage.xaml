<Page x:Class="PddTrainingApp.Views.StudentDashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Личный кабинет студента">

    <Grid Background="#f5f5f5">
        <ScrollViewer>
            <StackPanel x:Name="MainStackPanel" Margin="20">
                <!-- Заголовок -->
                <TextBlock Text="Личный кабинет студента" 
                           FontSize="24" FontWeight="Bold" 
                           Foreground="#333" Margin="0,0,0,20"/>

                <!-- Приветствие -->
                <Border Background="White" Padding="20" CornerRadius="10" Margin="0,0,0,20">
                    <TextBlock Text="{Binding WelcomeMessage}" FontSize="16" FontWeight="SemiBold"/>
                </Border>

                <!-- Мои задания -->
                <TextBlock x:Name="AssignmentsTitle" Text="Мои задания:" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>

                <!-- Сообщение когда заданий нет -->
                <TextBlock x:Name="NoAssignmentsText" Text="🎯 Нет активных заданий" 
                           FontStyle="Italic" Foreground="Gray" 
                           HorizontalAlignment="Center" Margin="0,10,0,20" FontSize="14"
                           Visibility="Collapsed"/>

                <ItemsControl x:Name="AssignmentsItemsControl" Margin="0,0,0,20">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="White" Margin="0,0,0,10" Padding="15" CornerRadius="8">
                                <StackPanel>
                                    <TextBlock Text="{Binding Block.Name}" FontWeight="Bold" FontSize="16"/>
                                    <TextBlock Text="{Binding Block.Description}" Margin="0,5,0,0"/>
                                    <TextBlock Text="{Binding DueDate, StringFormat='Срок выполнения: {0:dd.MM.yyyy}'}" 
                                               Foreground="Gray" Margin="0,5,0,0"/>
                                    <Button Content="Начать выполнение" Click="StartAssignment_Click" 
                                            Background="#28a745" Foreground="White" Padding="10,5"
                                            Margin="0,10,0,0" Tag="{Binding AssignmentId}" Cursor="Hand"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>


                <TextBlock Text="Моя статистика:" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                <Border Background="White" Padding="20" CornerRadius="10" Margin="0,0,0,20">
                    <StackPanel>
                        <ItemsControl x:Name="StatisticsItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#f8f9fa" Margin="0,0,0,5" Padding="10" CornerRadius="5">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="{Binding ModuleName}" FontWeight="SemiBold"/>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <TextBlock Text="{Binding CorrectAnswers}" FontWeight="Bold" Foreground="Green"/>
                                                <TextBlock Text="/"/>
                                                <TextBlock Text="{Binding TotalQuestions}" FontWeight="Bold"/>
                                                <TextBlock Text=" (" Margin="5,0,0,0"/>
                                                <TextBlock Text="{Binding Percentage}" FontWeight="Bold">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Percentage}" Value="100">
                                                                    <Setter Property="Foreground" Value="Green"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Percentage}" Value="0">
                                                                    <Setter Property="Foreground" Value="Red"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Percentage}">
                                                                    <Setter Property="Foreground" Value="Orange"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <TextBlock Text="%)" Margin="0,0,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <TextBlock x:Name="NoStatisticsText" Text="Вы еще не прошли ни одного теста" 
                                   HorizontalAlignment="Center" FontStyle="Italic" 
                                   Foreground="Gray" Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Быстрый доступ -->
                <TextBlock Text="Быстрый доступ" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                <WrapPanel Margin="0,0,0,20">
                    <Button Content="📚 Все модули" Click="AllModules_Click" 
                            Background="#3498db" Foreground="White" 
                            Padding="20,15" FontSize="14" FontWeight="Bold"
                            Margin="0,0,10,10" Cursor="Hand"/>
                </WrapPanel>

                <!-- Последняя активность -->
                <TextBlock Text="Последняя активность" FontSize="18" FontWeight="Bold" Margin="0,0,0,10"/>
                <Border Background="White" Padding="15" CornerRadius="10">
                    <StackPanel>
                        <TextBlock Text="Сегодня вы прошли:" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <ItemsControl x:Name="RecentActivityItemsControl">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Margin="0,2"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock x:Name="NoActivityText" Text="Сегодня вы еще не проходили тесты" 
                                   FontStyle="Italic" Foreground="Gray" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>